{% extends "dataviewer/base.html" %}

{% block styles %}
    {{ super() }}
    {% asset 'dimred/dimred-css' %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    {% set render_asset = h.dimred_render_asset(render_backend) %}
    {% if render_asset %}
        {% asset render_asset %}
    {% endif %}
{% endblock %}

{% block page %}
    <div class="dimred-view page">
        {% block dimred_wrapper %}
            <div class="module">
                {% block dimred_header %}
                    <h3 class="module-heading">
                        {{ resource_view.title or _('Dimensionality reduction') }}
                    </h3>
                {% endblock %}

                <div class="module-content dimred-container">
                    {% block dimred_body %}
                        {% if error %}
                            <div class="alert alert-danger">{{ error }}</div>
                        {% elif render_backend == 'matplotlib' and image_data_url %}
                            {% block dimred_image %}
                                <img
                                        src="{{ image_data_url }}"
                                        alt="{{ _('Dimensionality reduction plot') }}"
                                        class="dimred-plot"
                                />
                            {% endblock %}
                        {% elif h.dimred_render_module(render_backend) and embedding %}
                            {% block dimred_echarts %}
                                <div
                                        id="dimred-js-render"
                                        class="dimred-js-render"
                                        data-module="{{ h.dimred_render_module(render_backend) }}"
                                        data-embedding="{{ h.dump_json(embedding) }}"
                                        data-meta="{{ h.dump_json(meta) }}"
                                ></div>
                            {% endblock %}
                        {% else %}
                            <p>{{ _('No embedding image available.') }}</p>
                        {% endif %}

                        {% block dimred_meta %}
                            {% set info = meta.prepare_info or {} %}
                            {% if info %}
                                <div class="dimred-meta">
                                    <ul>
                                        {% if meta.method %}
                                            <li>
                                                <strong>{{ _('Method') }}:</strong> {{ h.dimred_method_label(meta.method) }}
                                            </li>
                                        {% endif %}
                                        <li>
                                            <strong>{{ _('Rows used') }}:</strong>
                                            {{ info.n_rows_used }}
                                            ({{ _('original') }}: {{ info.n_rows_original }})
                                        </li>
                                        <li>
                                            <strong>{{ _('Features') }}:</strong> {{ info.n_features }}
                                        </li>
                                        {% if info.numeric_used %}
                                            <li>
                                                <strong>{{ _('Numeric columns') }}:</strong>
                                                {{ ', '.join(info.numeric_used) }}
                                            </li>
                                        {% endif %}
                                        {% if info.categorical_used %}
                                            <li>
                                                <strong>{{ _('Categorical columns') }}:</strong>
                                                {{ ', '.join(info.categorical_used) }}
                                            </li>
                                        {% endif %}
                                        {% if info.color_by %}
                                            <li>
                                                <strong>{{ _('Color by') }}:</strong> {{ info.color_by }}
                                            </li>
                                        {% endif %}
                                    </ul>
                                </div>
                            {% endif %}
                        {% endblock %}

                        {% block dimred_actions %}
                            {% if resource_view.id and h.dimred_export_enabled() %}
                                <a class="btn btn-primary mt-3"
                                   href="{{ h.url_for('dimred.export_embedding', resource_id=resource.id, view_id=resource_view.id) }}">
                                    {{ _('Download embedding (CSV)') }}
                                </a>
                            {% endif %}
                        {% endblock %}
                    {% endblock %}
                </div>
            </div>
        {% endblock %}
    </div>
{% endblock %}
